# BVB - 基于帧同步的网络框架

这是一个基于Cocos Creator 3.8.4开发的帧同步网络框架，实现了多人在线小球移动游戏。

## 功能特性

- **帧同步网络框架**: 确保所有客户端的游戏状态保持同步
- **WebSocket通信**: 实时网络通信
- **输入处理系统**: 支持键盘输入（WASD/方向键）
- **小球物理系统**: 包含移动、碰撞检测和边界限制
- **多人游戏支持**: 支持多个玩家同时游戏
- **游戏状态管理**: 等待、准备、游戏中、暂停、结束等状态

## 项目结构

```
BVB/
├── assets/
│   ├── Scripts/
│   │   ├── Framework/
│   │   │   ├── Network/
│   │   │   │   └── NetworkManager.ts          # 网络管理器
│   │   │   └── FrameSync/
│   │   │       ├── FrameSyncManager.ts        # 帧同步管理器
│   │   │       └── InputManager.ts            # 输入管理器
│   │   └── Game/
│   │       ├── Ball.ts                        # 小球实体
│   │       ├── GameManager.ts                 # 游戏管理器
│   │       └── MainScene.ts                   # 主场景控制器
│   ├── Scenes/                                # 场景文件
│   └── Prefabs/                               # 预制体文件
├── server.js                                  # WebSocket服务器
├── server-package.json                        # 服务器依赖配置
└── README.md                                  # 说明文档
```

## 快速开始

### 1. 启动服务器

```bash
# 安装服务器依赖
npm install --package-lock-only --prefix . --package-lock-only package.json

# 启动服务器
node server.js
```

服务器默认运行在端口8080。

### 2. 在Cocos Creator中设置

1. 打开Cocos Creator 3.8.4
2. 导入项目
3. 创建主场景
4. 添加MainScene组件到场景根节点
5. 创建小球预制体并设置Ball组件
6. 配置UI元素（按钮、标签等）

### 3. 运行游戏

1. 在Cocos Creator中构建并运行项目
2. 点击"开始游戏"按钮连接服务器
3. 等待其他玩家加入
4. 所有玩家点击"准备"后游戏开始
5. 使用WASD或方向键控制小球移动

## 核心组件说明

### NetworkManager (网络管理器)
- 管理WebSocket连接
- 处理消息收发
- 提供网络状态查询

### FrameSyncManager (帧同步管理器)
- 管理帧同步逻辑
- 处理输入缓冲和帧数据
- 确保游戏状态同步

### InputManager (输入管理器)
- 处理键盘输入
- 将输入转换为帧同步数据
- 支持多种输入类型

### Ball (小球实体)
- 小球的物理表现
- 处理移动、碰撞等逻辑
- 根据帧数据更新状态

### GameManager (游戏管理器)
- 管理游戏状态和流程
- 处理玩家管理
- 协调各个系统

### MainScene (主场景控制器)
- 场景UI管理
- 用户交互处理
- 游戏状态显示

## 控制说明

- **WASD** 或 **方向键**: 控制小球移动
- **开始游戏**: 连接服务器并加入房间
- **准备**: 标记玩家准备状态
- **暂停/继续**: 暂停或恢复游戏

## 技术特点

1. **帧同步**: 采用帧同步技术确保所有客户端状态一致
2. **输入预测**: 支持输入预测和回滚机制
3. **状态同步**: 定期同步游戏状态防止数据偏差
4. **网络优化**: 针对网络延迟和丢包进行优化
5. **模块化设计**: 清晰的架构便于扩展和维护

## 扩展功能

- 添加更多游戏玩法
- 实现技能系统
- 增加房间管理功能
- 添加观战模式
- 实现录像回放
- 加入AI玩家

## 注意事项

1. 确保服务器和客户端的帧率设置一致
2. 网络延迟会影响游戏体验，建议在局域网环境下测试
3. 服务器资源有限，注意控制同时在线人数
4. 客户端需要保持稳定的网络连接

## 故障排除

1. **连接失败**: 检查服务器是否启动，端口是否正确
2. **同步问题**: 确认所有客户端使用相同的帧率设置
3. **输入延迟**: 检查网络延迟，调整缓冲帧数
4. **游戏卡顿**: 优化渲染性能，减少不必要的计算

## 许可证

MIT License